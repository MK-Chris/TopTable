[% # Note That the '-' at the beginning or end of TT code  -%]
[% # "chomps" the whitespace/newline at that end of the    -%]
[% # output (use View Source in browser to see the effect) -%]
[%-
team_club_html = FILTER html_entity; team.club.name; END;
team_name_html = FILTER html_entity; team.name; END;
-%]
<div id="team_details">
<h4>[% c.maketext("teams.form.legend.team-details") %]</h4>
<table class="responsive-vertical">
  <tr>
    <th>[% c.maketext("teams.field.club") %]</th>
[%
IF specific_season;
  SET uri = c.uri_for_action("/clubs/view_specific_season", [team.club.url_key, season.url_key]);
ELSE;
  SET uri = c.uri_for_action("/clubs/view_current_season", [team.club.url_key]);
END;
-%]
    <td><a href="[% uri %]">[% team.club.full_name | html_entity %]</a></td>
  </tr>
  <tr>
    <th>[% c.maketext("teams.field.home-night") %]</th>
    <td>[% team_season.home_night.weekday_name %]</td>
  </tr>
[% # Check we have a match start time in either the team, the club or the season;
IF team.default_match_start OR team.club.default_match_start OR season.default_match_start -%]
  <tr>
    <th>[% c.maketext("teams.field.start-time") %]</th>
    <td>[% FILTER truncate(5, '');
team.default_match_start OR team.club.default_match_start OR season.default_match_start;
END
-%]</td>
  </tr>
[%
END;
-%]
  <tr>
    <th>[% c.maketext("teams.field.captain") %]</th>
[%
IF team_season.captain.id;
  IF specific_season;
    SET uri = c.uri_for_action("/people/view_specific_season" [team_season.captain.url_key, season.url_key]);
  ELSE;
    SET uri = c.uri_for_action("/people/view_current_season" [team_season.captain.url_key]);
  END;
-%]
    <td><a href="[% uri %]">[% team_season.captain.display_name %]</a></td>
[%
ELSE;
-%]
    <td>[% c.maketext("teams.captain.none") %]</td>
[%
END;
-%]
  </tr>
</table>
</div>

[%
# Check there's a season
IF season;
  season_html = FILTER html_entity; season.name; END;
-%]
<div id="season-summary">
<h4><a href="[% c.uri_for_action("/seasons/view", [season.url_key]) %]">[% season.name | html_entity %]</a> Summary</h4>
[% # Check there's a team season
  IF team_season;
    IF specific_season;
      SET uri = c.uri_for_action("/league-tables/view_specific_season", [team_season.division.url_key, season.url_key]);
    ELSE;
      SET uri = c.uri_for_action("/league-tables/view_current_season", [team_season.division.url_key]);
    END;
-%]
<table class="responsive-vertical">
  <tr>
    <th>[% c.maketext("teams.field.division") %]</th>
    <td><a href="[% uri %]">[% team_season.division.name | html_entity %]</a></td>
  </tr>
  <tr>
    <th>[% c.maketext("teams.league-position") %]</th>
    <td>[% league_position %]</td>
  </tr>
[% IF team_season.season.league_ranking_template.assign_points -%]
  <tr>
    <th>[% c.maketext("teams.points") %]</th>
    <td>[% c.i18n_numberformat.format_number( team_season.points ) %]</td>
  </tr>
[% END -%]
  <tr>
    <th>[% c.maketext("teams.matches-played") %]</th>
    <td>[% c.i18n_numberformat.format_number( team_season.matches_played ) %]</td>
  </tr>
  <tr>
    <th>[% c.maketext("teams.matches-won") %]</th>
    <td>[% c.i18n_numberformat.format_number( team_season.matches_won ) %]</td>
  </tr>
  <tr>
    <th>[% c.maketext("teams.matches-drawn") %]</th>
    <td>[% c.i18n_numberformat.format_number( team_season.matches_drawn ) %]</td>
  </tr>
  <tr>
    <th>[% c.maketext("teams.matches-lost") %]</th>
    <td>[% c.i18n_numberformat.format_number( team_season.matches_lost ) %]</td>
  </tr>
  <tr>
    <th>[% c.maketext("teams.games-played") %]</th>
    <td>[% c.i18n_numberformat.format_number( team_season.games_played ) %]</td>
  </tr>
  <tr>
    <th>[% c.maketext("teams.games-won") %]</th>
    <td>[% c.i18n_numberformat.format_number( team_season.games_won ) %]</td>
  </tr>
  <tr>
    <th>[% c.maketext("teams.games-lost") %]</th>
    <td>[% c.i18n_numberformat.format_number( team_season.games_lost ) %]</td>
  </tr>
  <tr>
    <th>[% c.maketext("teams.games-won-percentage") %]</th>
    <td>[% c.i18n_numberformat.format_number( team_season.average_game_wins, 2, 1 ) %]</td>
  <tr>
    <th>[% c.maketext("teams.legs-played") %]</th>
    <td>[% c.i18n_numberformat.format_number( team_season.legs_played ) %]</td>
  </tr>
  <tr>
    <th>[% c.maketext("teams.legs-won") %]</th>
    <td>[% c.i18n_numberformat.format_number( team_season.legs_won ) %]</td>
  </tr>
  <tr>
    <th>[% c.maketext("teams.legs-lost") %]</th>
    <td>[% c.i18n_numberformat.format_number( team_season.legs_lost ) %]</td>
  </tr>
  <tr>
    <th>[% c.maketext("teams.legs-won-percentage") %]</th>
    <td>[% c.i18n_numberformat.format_number( team_season.average_leg_wins, 2, 1 ) %]</td>
  </tr>
  <tr>
    <th>[% c.maketext("teams.points-played") %]</th>
    <td>[% c.i18n_numberformat.format_number( team_season.points_played ) %]</td>
  </tr>
  <tr>
    <th>[% c.maketext("teams.points-won") %]</th>
    <td>[% c.i18n_numberformat.format_number( team_season.points_won ) %]</td>
  </tr>
  <tr>
    <th>[% c.maketext("teams.points-lost") %]</th>
    <td>[% c.i18n_numberformat.format_number( team_season.points_lost ) %]</td>
  </tr>
  <tr>
    <th>[% c.maketext("teams.points-won-percentage") %]</th>
    <td>[% c.i18n_numberformat.format_number( team_season.average_point_wins, 2, 1 ) %]</td>
  </tr>
</table>
</div>

[%
IF authorisation.person_create;
-%]
<a href="[% c.uri_for_action("/people/create_with_team_by_url_key", [team.club.url_key, team.url_key]) %]"><img src="[% c.uri_for("/static/images/icons/0009-Add-icon-32.png") %]" alt="[% c.maketext("people.create-for", team_club_html, team_name_html) %]" title="[% c.maketext("people.create-for", team_club_html, team_name_html) %]" /></a>
[%
END;
-%]
<h4>[% c.maketext("divisions.option.league-averages-singles") %]</h4>
[%
# Singles averages
INCLUDE "html/league-averages/view_singles.ttkt";
-%]

<h4>[% c.maketext("divisions.option.league-averages-doubles-individuals") %]</h4>
[%
# Individual doubles averages
INCLUDE "html/league-averages/view_doubles-individuals.ttkt";
-%]

<h4>[% c.maketext("divisions.option.league-averages-doubles-pairs") %]</h4>
[%
# Individual doubles averages
INCLUDE "html/league-averages/view_doubles-pairs.ttkt";
-%]

[%
  # Else for the check for a team season
  ELSE;
c.maketext("teams.message.did-not-enter", team_club_html, team_name_html, season_html);
  # End for the check for a season
  END %]
<div class="links">
[% # Loop through the seasons this team's been involved with
  SET i = 0;
  FOREACH team_season_item IN team_seasons;
    SET i = i + 1;
    IF i > 1;
-%]
 | 
[%
    # End loop
    END;
-%]
<a href="[% c.uri_for_action("/teams/view_specific_season_by_url_key", [team.club.url_key, team.url_key, team_season_item.season.url_key]) %]">[% team_season_item.season.name | html_entity %]</a>
[%
  # End the check for a season
  END;
-%]
</div>
[%
END;
 %]